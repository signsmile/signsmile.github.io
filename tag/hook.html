<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  
  <title>招牌式的微笑 - Hook</title>
<link href="../theme/css/style.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../" type="application/atom+xml" rel="alternate" title="招牌式的微笑 ATOM Feed" />
  
  <!--[if IE]>
  <style type="text/css"> 
  .twoColFixRtHdr #mainContent { zoom: 1; }
  </style>
  <![endif]-->

</head>

<body>

<div id="container">

  <div id="header">
  <h1><a href="../index.html">招牌式的微笑</h1>
  
  </div><!-- end #header -->
  
  <div id="topMenu">
  
    <ul>
    	<li><a href="../index.html">Home</a></li>
        <li>&ndash;</li>
        <li><a href="../archives.html">Archives</a></li>
        
    </ul>
  
  </div><!-- end #topMenu -->

  <div id="sidebar">
    <ul>
	<li>
	    <h3>Pages</h3>
	    <ul>
	    </ul>
	</li>
	<li>
            <h3>Categories</h3>
            <ul>
		     <li ><a href="../category/blogs.html">Blogs</a></li>
		     <li ><a href="../category/skills.html">skills</a></li>
	    </ul>
	</li>
	<li>
		<h3>Blogroll</h3>
		<ul>
                    <li><a href="http://getpelican.com/">Pelican</a></li>
                    <li><a href="http://python.org/">Python.org</a></li>
                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                    <li><a href="#">You can modify those links in your config file</a></li>
		</ul>
	</li>
        <li>
                <h3>Social</h3>
                <ul>
                    <li><a href="#">You can add links in your config file</a></li>
                    <li><a href="#">Another social link</a></li>
                </ul>
        </li><!-- /.social -->
        <li>
            <h3>Tags</h3>
            <ul>
                    <li><a href="../tag/pelican.html">Pelican</a></li>
                    <li><a href="../tag/markdown.html">Markdown</a></li>
                    <li><a href="../tag/github.html">github</a></li>
                    <li><a href="../tag/hook.html">Hook</a></li>
                    <li><a href="../tag/git.html">Git</a></li>
                    <li><a href="../tag/ssh.html">SSH</a></li>
                    <li><a href="../tag/putty.html">Putty</a></li>
                    <li><a href="../tag/atom.html">Atom</a></li>
            </ul>
        </li>
    </ul>
  </div><!-- end #sidebar -->

  <div id="mainContent">
  	
 
        
  	
    <div class="blogItem">
    
      <h2><a href="../zi-ding-yi-git.html">自定义Git</a></h2>
      <h3>Tue 26 December 2017</h3>
      
      <blockquote>
<p>之前在摆弄Pelican发布的时候发现git还有一个叫钩子的东东，处于好奇，想系统的看看自定义git的这一部分。
<a href="https://git-scm.com/book/en/v2">Pre git</a>这书是学习git强烈推荐的，这里的内容主要来自它的<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration">第八章自定义git</a>。</p>
</blockquote>
<h1>Git 配置</h1>
<blockquote>
<p>文章开头首先澄清了git的几个配置文件以及其优先级</p>
</blockquote>
<table>
<thead>
<tr>
<th>配置文件等级</th>
<th>系统级</th>
<th>用户级</th>
<th>项目级</th>
</tr>
</thead>
<tbody>
<tr>
<td>git命令</td>
<td>--system</td>
<td>--global</td>
<td>--local</td>
</tr>
<tr>
<td>windows路径</td>
<td>$PROGRAMDATA/Git/config</td>
<td>$HOME/.config/git/config or ~/.gitconfig</td>
<td>$GIT_DIR/config</td>
</tr>
<tr>
<td>linux路径</td>
<td>$(prefix)/etc/gitconfig</td>
<td>$HOME/.config/git/config or ~/.gitconfig</td>
<td>$GIT_DIR/config</td>
</tr>
</tbody>
</table>
<blockquote>
<p>然后介绍了几个有用的配置项</p>
</blockquote>
<h5>core.editor</h5>
<p><em>配置提交时候的默认编辑器</em></p>
<div class="highlight"><pre><span></span>$ git config --global core.editor emacs  //配置emacs为默认编辑器
$ git config --global core.editor <span class="s2">&quot;atom --wait&quot;</span> //atom官网提供的配置，配置atom为默认编辑器
</pre></div>


<h5>commit.template</h5>
<p><em>指定提交时候所有的格式模板文件</em></p>
<div class="highlight"><pre><span></span>$ git config --global commit.template ~/.gitmessage.txt
$ git commit
</pre></div>


<p>提交时候就会自动完成文件中信息的占位</p>
<h5>core.pager</h5>
<p>该配置项指定 Git 运行诸如 log 和 diff 等命令所使用的分页器。命令输出超过一页时，自动在每页输出后暂停，可以按空格继续显示，按q退出</p>
<h5>help.autocorrect</h5>
<p>自动改正并运行命令，如果你把 help.autocorrect 设置成 1，那么只要有一个命令被模糊匹配到了，Git 会自动运行该命令。
help.autocorrect 接受一个代表十分之一秒的整数。 所以如果你把它设置为 50, Git 将在自动执行命令前给你 5 秒的时间改变主意。</p>
<h5>merge.tool</h5>
<p>可用常用的图形化的diff及merge工具来替代默认的diff及merge工具。</p>
<h5>core.autocrlf</h5>
<div class="highlight"><pre><span></span>$ git config --global core.autocrlf <span class="nb">true</span> //提交时自动地把回车和换行转换成换行，而在检出代码时把换行转换成回车和换行（适合windows用户）
$ git config --global core.autocrlf input //提交时把回车和换行转换成换行，检出时不转换（适合Linux用户）
$ git config --global core.autocrlf <span class="nb">false</span> //都不转换（适合只在windows工作的用户）
</pre></div>


<h1>Git 属性</h1>
<p>主要讲根目录下.gitattributes文件的设置，这一章兴趣点不大，等以后需要用到了再<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes">细看</a>。
不过还是有两点可以关注的，docx2txt对word文件进行版本管理，利用exiftool 对图像进行版本管理。</p>
<h1>Git 钩子</h1>
<p>终于来到钩子了，这个才是我现在最关心的功能
<strong>在特定的重要动作发生时触发自定义脚本。 有两组这样的钩子：客户端的和服务器端的。 客户端钩子由诸如提交和合并这样的操作所调用，而服务器端钩子作用于诸如接收被推送的提交这样的联网操作。 </strong></p>
<p>把一个正确命名且可执行的文件放入 Git 目录下的 hooks 子目录中（.git/hooks默认有一些钩子的例子 ），即可激活该钩子脚本。
钩子的触发完全是根据钩子的文件名来，所以钩子的文件名一定要正确，主要有如下列表：</p>
<table>
<thead>
<tr>
<th>文件名</th>
<th>运行条件</th>
<th>应用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>pre-commit</td>
<td>钩子在键入提交信息前运行</td>
<td>用于检查即将提交的快照</td>
</tr>
<tr>
<td>prepare-commit-msg</td>
<td>启动提交信息编辑器之前，默认信息被创建之后运行</td>
<td>可以结合提交模板来使用它，动态地插入信息。</td>
</tr>
<tr>
<td>commit-msg</td>
<td>用户输入提交信息之后运行，提交动作执行之前</td>
<td>在提交通过前验证项目状态或提交信息。</td>
</tr>
<tr>
<td>post-commit</td>
<td>钩子在整个提交过程完成后运行</td>
<td>其可以改变 git commit 命令的输出，因此主要被用作通知提醒。</td>
</tr>
<tr>
<td>pre-rebase</td>
<td>运行于变基之前，以非零值退出可以中止变基的过程</td>
<td>禁止对已经推送的提交变基</td>
</tr>
<tr>
<td>post-rewrite</td>
<td>被那些会替换提交记录的命令调用（git commit --amend 和 git rebase等）</td>
<td></td>
</tr>
<tr>
<td>post-checkout</td>
<td>git checkout 成功运行后</td>
<td>项目环境用它调整你的工作目录</td>
</tr>
<tr>
<td>post-merge</td>
<td>git merge 成功运行后</td>
<td>恢复 Git 无法跟踪的工作区数据</td>
</tr>
<tr>
<td>pre-push</td>
<td>git push 运行期间， 更新了远程引用但尚未传送对象时被调用</td>
<td>在推送开始之前，用它验证对引用的更新操作</td>
</tr>
<tr>
<td>pre-receive</td>
<td>服务器处理来自客户端的推送操作时</td>
<td>阻止对引用进行非快进（non-fast-forward）的更新，或者对该推送所修改的所有引用和文件进行访问控制</td>
</tr>
<tr>
<td>update</td>
<td>为每一个准备更新的分支各运行一次</td>
<td>如推送者同时向多个分支推送内容，pre-receive 只运行一次，相比之下 update 则会为每一个被推送的分支各运行一次。</td>
</tr>
<tr>
<td>post-receive</td>
<td>在整个过程完结以后运行</td>
<td>用来更新其他系统服务或者通知用户</td>
</tr>
</tbody>
</table>
<p>钩子支持很多种脚本语言，Python，Ruby等均支持</p>
<p>下面是一个Demo，在Pelicam提交的过程中自动发布博客，并且上传到github
文件：post-commit</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
pelican content -o output -s pelicanconf.py
ghp-import -b master output -p
</pre></div>
</td></tr></table>

<p>有个坑啊，本来吧这个放在<code>pre-push</code>上面的，然后writer分支提交完后触发mater分支提交，mater分支提交完后又被自己触发，死循环了。。。 最终还是<code>post-commit</code>了。</p>	

      
      <h3 class="blogMeta">By <a href="#">signsmile</a>, Category: <a href="../category/skills.html">skills</a></h3>
<h3 class="blogMeta">Tags: <span><a href="../tag/git.html">Git</a> / </span>
<span><a href="../tag/hook.html">Hook</a> / </span>
</h3>    
    </div><!-- end #blogItem -->
  
  </div><!-- end #mainContent -->

<div class="clearfloat"></div>

  <div id="footer">
  
    <p><a href="http://css4free.com/" title="free CSS web site designs">Free CSS Gallery</a></p>
    <p>Proudly powered by <a href="http://getpelican.com">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
  </div><!-- end #footer -->

</div><!-- end #container -->
</body>
</html>